[gd_scene load_steps=34 format=3 uid="uid://industrial_circuit"]

[ext_resource type="Script" path="res://src/racing/race_track.gd" id="1"]

; ---- Sub-Resources ----

; Oval circuit with tight corners through warehouses (~500m lap)
[sub_resource type="Curve3D" id="Curve3D_industrial"]
_data = {
"points": PackedVector3Array(0, 0, 0, 0, 0, 0, 0, 0.5, 0, 0, 0, -5, 0, 0, 5, 0, 0.5, 15, 0, 0, -5, 0, 0, 5, 10, 0.5, 30, 5, 0, -5, -5, 0, 5, 30, 0.5, 45, 10, 0, 0, -10, 0, 0, 55, 0.5, 65, 5, 0, 5, -5, 0, -5, 65, 0.5, 85, -5, 0, 10, 5, 0, -10, 60, 0.5, 100, -10, 0, 5, 10, 0, -5, 45, 0.5, 108, -5, 0, -5, 5, 0, 5, 25, 0.5, 110, 0, 0, -10, 0, 0, 10, 5, 0.5, 105, 5, 0, -10, -5, 0, 10, -15, 0.5, 95, 10, 0, -5, -10, 0, 5, -35, 0.5, 75, 5, 0, -10, -5, 0, 10, -40, 0.5, 50, -5, 0, -10, 5, 0, 10, -30, 0.5, 30, -10, 0, 0, 10, 0, 0, -15, 0.5, 15, 0, 0, 5, 0, 0, -5, 0, 0.5, 0),
"tilts": PackedFloat32Array(0, 0, -0.03, 0, 0.02, 0.05, -0.08, -0.05, 0, -0.04, 0.03, -0.06, 0.04, -0.03, 0.02, 0, 0)
}

; Collision shapes
[sub_resource type="BoxShape3D" id="BoxShape_finish"]
size = Vector3(16, 5, 2)

[sub_resource type="BoxShape3D" id="BoxShape_cp"]
size = Vector3(16, 5, 2)

; Ground
[sub_resource type="BoxMesh" id="BoxMesh_ground"]
size = Vector3(140, 0.2, 140)

[sub_resource type="BoxShape3D" id="BoxShape_ground"]
size = Vector3(140, 0.2, 140)

[sub_resource type="StandardMaterial3D" id="mat_ground_industrial"]
albedo_color = Color(0.28, 0.28, 0.3, 1)
roughness = 0.9

; Walls
[sub_resource type="BoxMesh" id="BoxMesh_wall_long"]
size = Vector3(0.8, 2.4, 70)

[sub_resource type="BoxShape3D" id="BoxShape_wall_long"]
size = Vector3(0.8, 2.4, 70)

[sub_resource type="BoxMesh" id="BoxMesh_wall_medium"]
size = Vector3(0.8, 2.4, 40)

[sub_resource type="BoxShape3D" id="BoxShape_wall_medium"]
size = Vector3(0.8, 2.4, 40)

[sub_resource type="BoxMesh" id="BoxMesh_wall_short"]
size = Vector3(0.8, 2.4, 25)

[sub_resource type="BoxShape3D" id="BoxShape_wall_short"]
size = Vector3(0.8, 2.4, 25)

[sub_resource type="StandardMaterial3D" id="mat_wall_concrete"]
albedo_color = Color(0.4, 0.4, 0.42, 1)
roughness = 0.85

[sub_resource type="StandardMaterial3D" id="mat_wall_industrial"]
albedo_color = Color(0.3, 0.25, 0.22, 1)
roughness = 0.9

; Tire wall barrier
[sub_resource type="BoxMesh" id="BoxMesh_barrier_tire"]
size = Vector3(1.2, 0.8, 8)

[sub_resource type="BoxShape3D" id="BoxShape_barrier_tire"]
size = Vector3(1.2, 0.8, 8)

[sub_resource type="StandardMaterial3D" id="mat_tire_wall"]
albedo_color = Color(0.1, 0.1, 0.12, 1)
roughness = 0.95

; Props
[sub_resource type="CylinderMesh" id="CylinderMesh_drum"]
top_radius = 0.3
bottom_radius = 0.3
height = 0.9

[sub_resource type="StandardMaterial3D" id="mat_drum_yellow"]
albedo_color = Color(0.9, 0.8, 0.1, 1)
metallic = 0.4
roughness = 0.5

[sub_resource type="StandardMaterial3D" id="mat_drum_red"]
albedo_color = Color(0.7, 0.1, 0.1, 1)
metallic = 0.4
roughness = 0.5

[sub_resource type="StandardMaterial3D" id="mat_drum_blue"]
albedo_color = Color(0.1, 0.2, 0.7, 1)
metallic = 0.4
roughness = 0.5

[sub_resource type="BoxMesh" id="BoxMesh_crate"]
size = Vector3(1.2, 1.2, 1.2)

[sub_resource type="StandardMaterial3D" id="mat_crate"]
albedo_color = Color(0.45, 0.35, 0.25, 1)
roughness = 0.85

[sub_resource type="BoxMesh" id="BoxMesh_forklift"]
size = Vector3(2.5, 1.6, 1.5)

[sub_resource type="StandardMaterial3D" id="mat_forklift"]
albedo_color = Color(0.9, 0.5, 0.1, 1)
roughness = 0.6

; Environment
[sub_resource type="Environment" id="Environment_industrial"]
background_mode = 1
background_color = Color(0.35, 0.35, 0.38, 1)
ambient_light_source = 2
ambient_light_color = Color(0.6, 0.58, 0.55, 1)
ambient_light_energy = 0.5
tonemap_mode = 2
fog_enabled = true
fog_light_color = Color(0.5, 0.48, 0.45, 1)
fog_density = 0.0015

[node name="IndustrialCircuit" type="Node3D"]
script = ExtResource("1")
is_circuit = true
lap_count = 3

; ---- Racing Line (oval circuit through warehouse district) ----
[node name="RacingLine" type="Path3D" parent="." groups=["race_path"]]
curve = SubResource("Curve3D_industrial")

; ---- Start/Finish Line ----
[node name="FinishLine" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="FinishLine"]
shape = SubResource("BoxShape_finish")

[node name="FinishLabel" type="Label3D" parent="FinishLine"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 4, 0)
text = "START / FINISH"
font_size = 56
modulate = Color(1, 1, 0, 1)

; ---- Checkpoints (8 around circuit) ----
[node name="Checkpoints" type="Node3D" parent="."]

; CP0 — Exit of turn 1
[node name="CP0" type="Area3D" parent="Checkpoints"]
transform = Transform3D(0.866, 0, 0.5, 0, 1, 0, -0.5, 0, 0.866, 35, 1, 35)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP0"]
shape = SubResource("BoxShape_cp")

; CP1 — Mid backstraight
[node name="CP1" type="Area3D" parent="Checkpoints"]
transform = Transform3D(0, 0, 1, 0, 1, 0, -1, 0, 0, 60, 1, 60)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP1"]
shape = SubResource("BoxShape_cp")

; CP2 — Approaching turn 2 (hairpin)
[node name="CP2" type="Area3D" parent="Checkpoints"]
transform = Transform3D(0.5, 0, 0.866, 0, 1, 0, -0.866, 0, 0.5, 65, 1, 85)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP2"]
shape = SubResource("BoxShape_cp")

; CP3 — Exit of turn 2
[node name="CP3" type="Area3D" parent="Checkpoints"]
transform = Transform3D(-0.5, 0, 0.866, 0, 1, 0, -0.866, 0, -0.5, 50, 1, 105)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP3"]
shape = SubResource("BoxShape_cp")

; CP4 — Through warehouse section
[node name="CP4" type="Area3D" parent="Checkpoints"]
transform = Transform3D(-0.866, 0, 0.5, 0, 1, 0, -0.5, 0, -0.866, 20, 1, 110)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP4"]
shape = SubResource("BoxShape_cp")

; CP5 — Turn 3 entry
[node name="CP5" type="Area3D" parent="Checkpoints"]
transform = Transform3D(-1, 0, 0, 0, 1, 0, 0, 0, -1, -10, 1, 100)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP5"]
shape = SubResource("BoxShape_cp")

; CP6 — Turn 4 (final corner)
[node name="CP6" type="Area3D" parent="Checkpoints"]
transform = Transform3D(-0.707, 0, -0.707, 0, 1, 0, 0.707, 0, -0.707, -35, 1, 60)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP6"]
shape = SubResource("BoxShape_cp")

; CP7 — Front straight before finish
[node name="CP7" type="Area3D" parent="Checkpoints"]
transform = Transform3D(0, 0, -1, 0, 1, 0, 1, 0, 0, -25, 1, 25)
collision_layer = 32

[node name="CollisionShape3D" type="CollisionShape3D" parent="Checkpoints/CP7"]
shape = SubResource("BoxShape_cp")

; ---- Spawn Points (player + 7 AI in 4x2 grid) ----
[node name="SpawnPoints" type="Node3D" parent="."]

[node name="P1" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 1, -8)

[node name="P2" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3, 1, -8)

[node name="P3" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 1, -13)

[node name="P4" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3, 1, -13)

[node name="P5" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 1, -18)

[node name="P6" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3, 1, -18)

[node name="P7" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 1, -23)

[node name="P8" type="Marker3D" parent="SpawnPoints"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3, 1, -23)

; ---- Ground (industrial concrete) ----
[node name="Ground" type="StaticBody3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 15, 0, 55)
collision_layer = 1

[node name="MeshInstance3D" type="MeshInstance3D" parent="Ground"]
mesh = SubResource("BoxMesh_ground")
material_override = SubResource("mat_ground_industrial")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Ground"]
shape = SubResource("BoxShape_ground")

; ---- Track Barriers & Walls ----
[node name="Barriers" type="Node3D" parent="."]

; Outer wall - straight section
[node name="OuterWall1" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -8, 1.2, 25)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/OuterWall1"]
mesh = SubResource("BoxMesh_wall_medium")
material_override = SubResource("mat_wall_concrete")

[node name="Collision" type="CollisionShape3D" parent="Barriers/OuterWall1"]
shape = SubResource("BoxShape_wall_medium")

; Inner island wall
[node name="InnerWall1" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(0, 0, 1, 0, 1, 0, -1, 0, 0, 8, 1.2, 25)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/InnerWall1"]
mesh = SubResource("BoxMesh_wall_short")
material_override = SubResource("mat_wall_concrete")

[node name="Collision" type="CollisionShape3D" parent="Barriers/InnerWall1"]
shape = SubResource("BoxShape_wall_short")

; Outer wall - backstraight
[node name="OuterWall2" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(0, 0, 1, 0, 1, 0, -1, 0, 0, 75, 1.2, 70)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/OuterWall2"]
mesh = SubResource("BoxMesh_wall_long")
material_override = SubResource("mat_wall_concrete")

[node name="Collision" type="CollisionShape3D" parent="Barriers/OuterWall2"]
shape = SubResource("BoxShape_wall_long")

; Hairpin apex barrier
[node name="HairpinBarrier" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(-0.707, 0, 0.707, 0, 1, 0, -0.707, 0, -0.707, 70, 1.2, 100)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/HairpinBarrier"]
mesh = SubResource("BoxMesh_barrier_tire")
material_override = SubResource("mat_tire_wall")

[node name="Collision" type="CollisionShape3D" parent="Barriers/HairpinBarrier"]
shape = SubResource("BoxShape_barrier_tire")

; Warehouse walls
[node name="WarehouseWallLeft" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(-1, 0, 0, 0, 1, 0, 0, 0, -1, 5, 1.2, 110)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/WarehouseWallLeft"]
mesh = SubResource("BoxMesh_wall_medium")
material_override = SubResource("mat_wall_industrial")

[node name="Collision" type="CollisionShape3D" parent="Barriers/WarehouseWallLeft"]
shape = SubResource("BoxShape_wall_medium")

[node name="WarehouseWallRight" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(-1, 0, 0, 0, 1, 0, 0, 0, -1, 35, 1.2, 110)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/WarehouseWallRight"]
mesh = SubResource("BoxMesh_wall_medium")
material_override = SubResource("mat_wall_industrial")

[node name="Collision" type="CollisionShape3D" parent="Barriers/WarehouseWallRight"]
shape = SubResource("BoxShape_wall_medium")

; Turn 4 outer wall
[node name="Turn4Wall" type="StaticBody3D" parent="Barriers"]
transform = Transform3D(-0.707, 0, -0.707, 0, 1, 0, 0.707, 0, -0.707, -45, 1.2, 75)
collision_layer = 2

[node name="Mesh" type="MeshInstance3D" parent="Barriers/Turn4Wall"]
mesh = SubResource("BoxMesh_wall_medium")
material_override = SubResource("mat_wall_concrete")

[node name="Collision" type="CollisionShape3D" parent="Barriers/Turn4Wall"]
shape = SubResource("BoxShape_wall_medium")

; ---- Industrial Props & Obstacles ----
[node name="IndustrialProps" type="Node3D" parent="."]

; Oil drums
[node name="OilDrums1" type="MeshInstance3D" parent="IndustrialProps"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 10, 0.8, 50)
mesh = SubResource("CylinderMesh_drum")
material_override = SubResource("mat_drum_yellow")

[node name="OilDrums2" type="MeshInstance3D" parent="IndustrialProps"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 65, 0.8, 95)
mesh = SubResource("CylinderMesh_drum")
material_override = SubResource("mat_drum_red")

[node name="OilDrums3" type="MeshInstance3D" parent="IndustrialProps"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -40, 0.8, 70)
mesh = SubResource("CylinderMesh_drum")
material_override = SubResource("mat_drum_blue")

; Crates
[node name="Crate1" type="MeshInstance3D" parent="IndustrialProps"]
transform = Transform3D(0.866, 0, 0.5, 0, 1, 0, -0.5, 0, 0.866, -5, 0.6, 80)
mesh = SubResource("BoxMesh_crate")
material_override = SubResource("mat_crate")

[node name="Crate2" type="MeshInstance3D" parent="IndustrialProps"]
transform = Transform3D(0.707, 0, -0.707, 0, 1, 0, 0.707, 0, 0.707, 40, 0.6, 115)
mesh = SubResource("BoxMesh_crate")
material_override = SubResource("mat_crate")

; Forklift
[node name="Forklift" type="MeshInstance3D" parent="IndustrialProps"]
transform = Transform3D(0.5, 0, 0.866, 0, 1, 0, -0.866, 0, 0.5, 12, 0.8, 105)
mesh = SubResource("BoxMesh_forklift")
material_override = SubResource("mat_forklift")

; ---- Lighting (industrial/warehouse) ----
[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.707, -0.5, 0.5, 0, 0.707, 0.707, -0.707, -0.5, 0.5, 0, 25, 0)
light_color = Color(1, 0.92, 0.8, 1)
light_energy = 0.7
shadow_enabled = true

; Industrial overhead lights
[node name="WarehouseLight1" type="OmniLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 20, 10, 100)
light_color = Color(1, 0.95, 0.85, 1)
light_energy = 5.0
omni_range = 35.0

[node name="WarehouseLight2" type="OmniLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 50, 10, 80)
light_color = Color(1, 0.95, 0.85, 1)
light_energy = 5.0
omni_range = 35.0

; Track lights
[node name="TrackLight1" type="SpotLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -0.866, 0.5, 0, -0.5, -0.866, -10, 8, 10)
light_color = Color(1, 0.9, 0.7, 1)
light_energy = 2.5
spot_range = 40.0
spot_angle = 60.0

[node name="TrackLight2" type="SpotLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -0.866, 0.5, 0, -0.5, -0.866, 70, 8, 60)
light_color = Color(1, 0.9, 0.7, 1)
light_energy = 2.5
spot_range = 40.0
spot_angle = 60.0

[node name="TrackLight3" type="SpotLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -0.866, 0.5, 0, -0.5, -0.866, 60, 8, 105)
light_color = Color(1, 0.9, 0.7, 1)
light_energy = 2.5
spot_range = 40.0
spot_angle = 60.0

[node name="TrackLight4" type="SpotLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -0.866, 0.5, 0, -0.5, -0.866, -35, 8, 80)
light_color = Color(1, 0.9, 0.7, 1)
light_energy = 2.5
spot_range = 40.0
spot_angle = 60.0

; ---- World Environment ----
[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_industrial")
